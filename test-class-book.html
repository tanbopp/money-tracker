<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Kas Kelas - Money Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 dark:bg-gray-900">
    <div class="max-w-4xl mx-auto p-6">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-8">Test Kas Kelas</h1>
        
        <!-- Test Controls -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-6">
            <div class="p-6">
                <h2 class="text-xl font-semibold mb-4">Test Controls</h2>
                <div class="flex flex-wrap gap-3">
                    <button onclick="addSampleData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-plus mr-2"></i>Add Sample Data
                    </button>
                    <button onclick="clearAllData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-trash mr-2"></i>Clear All Data
                    </button>
                    <button onclick="debugBookData()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-bug mr-2"></i>Debug
                    </button>
                    <button onclick="forceRefreshAllDisplays()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-sync mr-2"></i>Refresh
                    </button>
                    <button onclick="location.reload()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-redo mr-2"></i>Reload Page
                    </button>
                </div>
            </div>
        </div>

        <!-- Status Display -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-6">
            <div class="p-6">
                <h2 class="text-xl font-semibold mb-4">Data Status</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600" id="memory-count">0</div>
                        <div class="text-sm text-gray-600">In Memory</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600" id="storage-count">0</div>
                        <div class="text-sm text-gray-600">In Storage</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-600" id="balance-amount">Rp 0</div>
                        <div class="text-sm text-gray-600">Balance</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Class Book Summary -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-6">
            <div class="p-6">
                <h2 class="text-xl font-semibold mb-4">Kas Kelas Summary</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600" id="class-total-income">Rp 0</div>
                        <div class="text-sm text-green-600">Total Pemasukan</div>
                    </div>
                    <div class="text-center p-4 bg-red-50 rounded-lg">
                        <div class="text-2xl font-bold text-red-600" id="class-total-expense">Rp 0</div>
                        <div class="text-sm text-red-600">Total Pengeluaran</div>
                    </div>
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600" id="class-balance">Rp 0</div>
                        <div class="text-sm text-blue-600">Saldo</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions List -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h2 class="text-xl font-semibold">Transactions</h2>
            </div>
            <div class="p-6">
                <div id="class-transactions-list" class="space-y-3">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-book text-4xl mb-2"></i>
                        <p>Belum ada transaksi kas kelas</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Include main script functions
        console.log('Loading test page...');

        // Test functions
        function addSampleData() {
            const sampleTransactions = [
                {
                    id: Date.now().toString() + '_1',
                    type: 'income',
                    categoryId: 'uang-kas',
                    categoryName: 'Uang Kas',
                    icon: 'fas fa-coins',
                    color: '#10B981',
                    amount: 50000,
                    date: new Date().toISOString().split('T')[0],
                    description: 'Uang kas bulanan siswa',
                    formattedDate: new Date().toLocaleDateString('id-ID'),
                    createdAt: new Date().toISOString()
                },
                {
                    id: Date.now().toString() + '_2',
                    type: 'expense',
                    categoryId: 'kebersihan',
                    categoryName: 'Kebersihan',
                    icon: 'fas fa-broom',
                    color: '#8B5CF6',
                    amount: 15000,
                    date: new Date().toISOString().split('T')[0],
                    description: 'Beli sapu dan pel',
                    formattedDate: new Date().toLocaleDateString('id-ID'),
                    createdAt: new Date().toISOString()
                }
            ];

            // Add to global array if it exists, otherwise create it
            if (typeof classBookTransactions === 'undefined') {
                window.classBookTransactions = [];
            }
            
            sampleTransactions.forEach(transaction => {
                classBookTransactions.unshift(transaction);
            });

            // Save and update
            if (typeof saveBookData === 'function') {
                saveBookData();
            } else {
                localStorage.setItem('moneyTracker_classBook', JSON.stringify(classBookTransactions));
            }
            
            updateTestDisplay();
            alert('Sample data added successfully!');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data?')) {
                localStorage.removeItem('moneyTracker_classBook');
                if (typeof classBookTransactions !== 'undefined') {
                    classBookTransactions.length = 0;
                }
                updateTestDisplay();
                alert('All data cleared!');
            }
        }

        function updateTestDisplay() {
            // Load data if not already loaded
            let transactions = [];
            
            if (typeof classBookTransactions !== 'undefined') {
                transactions = classBookTransactions;
            } else {
                const stored = localStorage.getItem('moneyTracker_classBook');
                transactions = stored ? JSON.parse(stored) : [];
            }

            // Update status display
            document.getElementById('memory-count').textContent = transactions.length;
            
            const storedData = localStorage.getItem('moneyTracker_classBook');
            const storedCount = storedData ? JSON.parse(storedData).length : 0;
            document.getElementById('storage-count').textContent = storedCount;

            // Calculate balance
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpense;

            document.getElementById('balance-amount').textContent = formatCurrency(balance);
            document.getElementById('class-total-income').textContent = formatCurrency(totalIncome);
            document.getElementById('class-total-expense').textContent = formatCurrency(totalExpense);
            document.getElementById('class-balance').textContent = formatCurrency(balance);

            // Update transactions list
            const container = document.getElementById('class-transactions-list');
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-book text-4xl mb-2"></i>
                        <p>Belum ada transaksi kas kelas</p>
                    </div>
                `;
            } else {
                container.innerHTML = transactions.map(transaction => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border">
                        <div class="flex items-center space-x-4">
                            <div class="p-2 rounded-lg" style="background-color: ${transaction.color}20">
                                <i class="${transaction.icon}" style="color: ${transaction.color}"></i>
                            </div>
                            <div>
                                <p class="font-medium">${transaction.categoryName}</p>
                                <p class="text-sm text-gray-600">${transaction.description}</p>
                                <p class="text-xs text-gray-500">${transaction.formattedDate}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                            </p>
                        </div>
                    </div>
                `).join('');
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Initialize display on load
        document.addEventListener('DOMContentLoaded', function() {
            updateTestDisplay();
            
            // Auto-refresh every 5 seconds
            setInterval(updateTestDisplay, 5000);
        });
    </script>
    
    <!-- Load main script for additional functions -->
    <script src="script.js"></script>
</body>
</html>
